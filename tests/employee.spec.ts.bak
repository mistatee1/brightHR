import { test, expect } from '@playwright/test';
import { AuthPage } from './pages/auth.page';
import { EmployeesPage } from './pages/employees.page';

const APP_URL = process.env.APP_URL || 'http://localhost:3000';
const TEST_EMAIL = process.env.TEST_EMAIL || 'mranthonyakin@gmail.com';
const TEST_PASSWORD = process.env.TEST_PASSWORD || '@Uthenticateme1290';

test.describe('Employees flow (POM)', () => {
  test('login, add two employees, verify they appear', async ({ page }) => {
    const auth = new AuthPage(page);
    const employees = new EmployeesPage(page);

    await auth.goto(APP_URL);
    await auth.login(TEST_EMAIL, TEST_PASSWORD);

    await expect(employees.navEmployees).toBeVisible();
    await employees.navigate();

    const e1 = { first: 'Anthony', last: 'Akin', email: 'anthony.akin+1@example.com' };
    const e2 = { first: 'Morgan', last: 'Smith', email: 'morgan.smith+2@example.com' };

    await employees.addEmployee(e1.first, e1.last, e1.email);
    await employees.addEmployee(e2.first, e2.last, e2.email);

    expect(await employees.hasEmployee(e1.first, e1.last, e1.email)).toBeTruthy();
    expect(await employees.hasEmployee(e2.first, e2.last, e2.email)).toBeTruthy();
  });
});
